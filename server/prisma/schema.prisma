generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch"]
}

datasource db {
  provider = "postgresql"
  url = "postgresql://postgres:postgres@127.0.0.1:5432/db"
}

enum FeatureType {
  Release
  GradualRollout
  Permission
  Experimental
  Operational
}

model Application {
  id String @id
  name String
  client Client @relation(fields: [clientId], references: [id])
  clientId String
  createdAt DateTime @default(now())
}

model DashboardUser {
  id String @id
  name String
  email String @unique
  projects Project[]
  client Client @relation(fields: [clientId], references: [id])
  clientId String
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
}

model Client {
  id String @id
  name String
  apps Application[]
  projects Project[]
  environments Environment[]
  users User[]
  dashboardUsers DashboardUser[]
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
}

model User {
  id String @id
  name String
  client Client @relation(fields: [clientId], references: [id])
  clientId String
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
}

model Environment {
  id String @id
  name String
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
  projects Project[]
  envFeatureToggles EnvFeature[]
  client Client @relation(fields: [clientId], references: [id])
  clientId String
}

model Project {
  id String @id
  name String
  description String
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
  client Client @relation(fields: [clientId], references: [id])
  clientId String
  dashboardUsers DashboardUser[]
  environments Environment[]
  features Feature[]
  flows Flow[]
}

model EnvFeature {
  id String @id
  state Boolean
  updatingUser String
  queriedAt DateTime?
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
  environment Environment @relation(fields: [environmentId], references: [id])
  environmentId String
  featureToggle Feature @relation(fields: [featureToggleId], references: [id])
  featureToggleId String
  version Int @default(0)
}

model Feature {
  id String @id
  name String
  type FeatureType
  createdBy String
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
  project Project @relation(fields: [projectId], references: [id])
  projectId String
  flows Flow[]
  envFeatureToggles EnvFeature[]
}

model Flow {
  id String @id
  name String
  updatedAt DateTime @updatedAt @default(now())
  createdAt DateTime @default(now())
  project Project @relation(fields: [projectId], references: [id])
  projectId String
  features Feature[]
}
